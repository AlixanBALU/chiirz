{% extends 'base.html.twig' %}

{% block title %}User{% endblock %}

{% block body %}
    <section class="user">
        <header class="user__header">
            <div class="user__header__heading">
                <img src="{{ asset('img/confetti.png') }}" alt="">
                <div class="title title--h3">Profil du fêtard</div>
            </div>
            <div class="user__header__profil">
                <img src="{{ asset('img/happy-smiley.png') }}" alt="{{ user.pseudo }}" class="user__header__user">
                <h3 class="title title--h3">{{ user.pseudo }}</h3>
                {% if app.user.id == user.id %}
                    <a href="{{ path('app_user_edit', {'id': user.id}) }}" class="user__header__alter">Modifier mon profil</a>
                {% endif %}
            </div>
            <div class="user__header__register-date">
                Membre depuis le <span> {{ user.registered | date('d/m/20y', 'Europe/Paris',  'fr_FR')}} </span>
            </div>
            <div class="user__header__city">
                <img src="{{ asset('img/city-night.png') }}" alt="">
                <div class="user__header__city__text">
                    <div class="user__header__city__text user__header__city__text__item--comrad">Camarade de</div>
                    <div class="user__header__city__text user__header__city__text__item--city">{{ user.fkCity.name }}</div>
                </div>
            </div>
            <div class="user__header__btn-cntr">
                <a href="{{ path('app_itinerary_new') }}" class="btn btn--primary">Créer une route de la soif</a>
                <a href="{{ path('city_from_user', {'id': user.fkCity.id}) }}" class="btn btn--secondary">Trouver un route</a>
            </div>
            {% if app.user.id == user.id or is_granted('ROLE_ADMIN') %}
                {{ include('user/_delete_form.html.twig') }}
                {% if app.user.id == user.id %}
                    <a href="{{ path('logout') }}" class="user__header__alter">Deconnexion</a>
                {% endif %}
            {% endif %}
        </header>

        <div class="user__favorite">
            <h2 class="title title--h3">Mes routes de la soif favorites </h2>
            {% for l in user.likes %}
                {% if l.favorite %}
                    <a class="user__favorite__itiner-container__card" href="{{ path('app_itinerary_show', {'id': l.fkItinerary.id}) }}">
                        <img class="user__favorite__itiner-container__card__img-bar" href="" alt="{{ l.fkItinerary.name }}">
                        <div class="user__favorite__itiner-container__card__desc">
                            <h3 class="title title--h4">{{ l.fkItinerary.name }}</h3>
                            <div class="user__favorite__itiner-container__card__row p p--16">
                                <div>{{ l.fkItinerary.bar.numberOfSteps }} Étapes</div>
                                <div. class="user__favorite__itiner-container__card__row__rate">
                                    <img src="{{ asset('img/svg/star.svg') }}" alt="☆">
                                    <div>
                                        {% if l.fkItinerary.comments is empty %}
                                            N/A
                                        {% else %}
                                            {% set rating = 0 %}
                                            {% set ratingIndex = 0 %}
                                            {% for comment in l.fkItinerary.comments %}
                                                {% set rating = rating + comment.rate %}
                                                {% set ratingIndex = ratingIndex + 1 %}
                                            {% endfor %}
                                            {{ rating / ratingIndex }}
                                        {% endif %}
                                    </div>
                                </div.
                            </div>
                            <div class="user__favorite__itiner-container__card__row">
                                <div>{{ l.fkItinerary.distance }}</div>
                                <div class="user__favorite__itiner-container__card__row__price">
                                    {% for i in 1..l.fkItinerary.price %}
                                        <span>€</span>
                                    {% endfor %}
                                </div>
                            </div>
                        </div>
                    </a>
                {% endif %}
            {% endfor %}
        </div>
    </section>

{% endblock %}
