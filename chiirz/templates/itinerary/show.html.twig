{% extends 'base.html.twig' %}

{% block title %}Itinerary{% endblock %}

{% block stylesheets %}
    {{ parent() }}
    <link href="https://cdn.jsdelivr.net/npm/@splidejs/splide@4.1.4/dist/css/splide.min.css" rel="stylesheet">
{% endblock %}

{% block javascripts %}
    {{ parent() }}
    <script src="{{ asset('js/splide.min.js') }}" defer></script>
    <script src="{{ asset('js/itinerary.js') }}" defer></script>
    <script src="https://cdn.jsdelivr.net/npm/@splidejs/splide@4.1.4/dist/js/splide.min.js"></script>
{% endblock %}

{% block body %}

    <a href="" id="backButton" class="back-itinerary">
        <img src="{{ asset('img/svg/back.svg') }}" alt="<">
        Retour en arri√®re
    </a>
    <section class="section-itinerary">
        <div class="section-itinerary__maps">
            {# Int√©gration Google Maps #}
        </div>
        <div class="section-itinerary__content">
            <div class="section-itinerary__content__creator">
                <img src="{{ asset('img/glowing_star.png') }}" alt="‚òÜ">
                <p>Route de la soif imagin√© par <a href="{{ path('user_index', { 'id': itinerary.fkuser }) }}" class="section-itinerary__content__creator__link">{{ itinerary.fkuser }}</a></p>
            </div>
            <h1>{{ itinerary.name }}</h1>
            <div class="section-itinerary__content__rate">
                <div class="section-itinerary__content__rate__rating">
                    <img src="{{ asset('img/svg/star/svg') }}" alt="‚òÜ">
                    <div>
                    {% if itinerary.likes is empty %}
                        N/A
                    {% else %}
                        {% set rating = 0 %}
                        {% set ratingIndex = 0 %}
                        {% for l in itinerary.likes %}
                            {% set rating = rating + comment.rate %}
                            {% set ratingIndex = ratingIndex + 1 %}
                        {% endfor %}
                        {{ rating / ratingIndex }}
                    {% endif %}
                    </div>
                </div>
                <div class="section-itinerary__content__rate__price">
                    {% for i in 1..itinerary.price %}
                        <img src="{{ asset('img/svg/euro.svg') }}" alt="‚Ç¨">
                    {% endfor %}
                </div>
            </div>
            {% if itinerary.text is not empty %}
                <p class="section-itinerary__content__paragraph">{{ itinerary.text }}</p>
            {% endif %}
            <div class="section-itinerary__content__buttons">
                <a href="#parcours" class="section-itinerary__content__buttons section-itinerary__content__buttons--go">
                    <div>C'est parti !</div>
                    <img src="{{ asset('img/smiling_face.png') }}" alt="üòù">
                </a>
                <a href="" id="openOnGoogleMaps" class="section-itinerary__content__buttons section-itinerary__content__buttons--ggmaps">
                    <div>Ouvrir sur Google Maps</div>
                    <img src="{{ asset('img/svg/external_links.svg') }}" alt="‚Üó">
                </a>
            </div>
            <div class="section-itinerary__content__like">
                <img src="{{ asset('img/svg/heart_color.svg') }}" alt="‚ô°" id="likeHeartImg">
                <div id="likeText">Ajouter aux favoris</div>
            </div>
            <div class="section-itinerary__content__steps">
                <h3>{{ itinerary.bar['numberOfSteps'] }}{# {{ itinerary.bar.numberOfSteps }} #} √âtapes</h3>
                <ul>
                    {% for s in itinerary.bar['steps'] %}
                        <li>{{ s.name }}</li>
                    {% endfor %}
                </ul>
            </div>
            <p class="section-itinerary__content__distance">Longeur du parcours : <span class="section-itinerary__content__distance__number">{{ itinerary.distance }}</p>
        </div>
    </section>
    <section class="section-parcours" id="parcours">
        <div class="section-parcours__progress-bar">

        </div>
        <section class="splide" aria-label="Splide Basic HTML Example">
            <div class="splide__track">
                  <ul class="splide__list">
                      <li class="splide__slide"><img src="https://upload.wikimedia.org/wikipedia/commons/thumb/b/b6/Image_created_with_a_mobile_phone.png/1200px-Image_created_with_a_mobile_phone.png" alt=""></li>
                      <li class="splide__slide"><img src="https://images.unsplash.com/photo-1575936123452-b67c3203c357?ixlib=rb-4.0.3&ixid=MnwxMjA3fDB8MHxzZWFyY2h8Mnx8aW1hZ2V8ZW58MHx8MHx8&w=1000&q=80" alt=""></li>
                      <li class="splide__slide"><img src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcQRkWUw-AxIel_s80qW25IJ3CfguVz0eNPnYmfHaRYW&s" alt=""></li>
                  </ul>
            </div>
        </section>
    </section>

    <script>
        import * as it from "{{ asset('js/itinerary.js') }}";
        var itineraryJson = {{ itinerary.bar | json_encode | raw }};
        console.log(itineraryJson);
        // On lance la fonction de tout le js en fonction du itineraryJson
        it.getItinerary(itineraryJson);
    </script>
{% endblock %}
